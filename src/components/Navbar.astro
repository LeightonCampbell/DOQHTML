---
import { Image } from 'astro:assets';

const pathname = Astro.url.pathname;
const isHomePage = pathname === '/';
const currentPath = pathname;
const navLinks = [
  { href: '/services/', label: 'Services' },
  { href: '/faqs/', label: 'FAQs' },
  { href: '/articles/', label: 'Articles' },
  { href: '/join-as-pro/', label: 'Join As A Pro' },
];
const ctaHref = '/#get-quote';
const phone = 'tel:+18185847389';
---

<header
  id="site-header"
  class:list={[
    'top-0 z-50 w-full transition-colors duration-200',
    isHomePage ? 'fixed header-transparent' : 'sticky site-header-scrolled header-solid',
  ]}
  data-transparent-header={isHomePage ? 'true' : undefined}
  style={isHomePage ? 'background: transparent !important; background-color: transparent !important;' : undefined}
  aria-label="Site header"
>
  <div class="container-max w-full flex h-16 items-center justify-between gap-4 px-4 md:px-8 lg:px-16">
    <a href="/" class="header-logo-wrap relative flex h-10 md:h-12 min-w-[140px] items-center bg-transparent transition opacity-90 hover:opacity-100" aria-label="DoQuality – Home">
      {isHomePage ? (
        <>
          <Image
            src="/images/logo-light.png"
            alt="DoQuality – Smart, Fast, Reliable"
            width={150}
            height={48}
            class="header-logo header-logo--light absolute left-0 top-1/2 h-10 md:h-12 w-auto -translate-y-1/2 object-contain object-left"
            loading="eager"
          />
          <Image
            src="/images/logo-dark.png"
            alt="DoQuality – Smart, Fast, Reliable"
            width={150}
            height={48}
            class="header-logo header-logo--dark absolute left-0 top-1/2 h-10 md:h-12 w-auto -translate-y-1/2 object-contain object-left"
            loading="eager"
          />
        </>
      ) : (
        <Image
          src="/images/logo-dark.png"
          alt="DoQuality – Smart, Fast, Reliable"
          width={150}
          height={48}
          class="header-logo h-10 md:h-12 w-auto object-contain object-left"
          loading="eager"
        />
      )}
    </a>

    <nav class="hidden items-center gap-8 md:flex" aria-label="Main navigation">
      {navLinks.map(({ href, label }) => (
        <a
          href={href}
          class="header-nav-link text-sm font-bold transition hover:opacity-90"
          class:list={[currentPath.startsWith(href) ? 'header-nav-link--active' : '']}
        >
          {label}
        </a>
      ))}
    </nav>

    <div class="flex items-center gap-4">
      <a href={phone} class="header-phone hidden items-center gap-2 text-sm font-bold transition hover:opacity-90 sm:flex" aria-label="Call (818) 584-7389">
        <svg class="header-phone-icon h-4 w-4 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
        </svg>
        <span class="header-phone-text">(818) 584-7389</span>
      </a>
      <button
        type="button"
        data-open-booking="true"
        class="header-cta hidden rounded-lg px-4 py-2.5 text-sm font-semibold text-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-[#f97415] focus:ring-offset-2 focus:ring-offset-transparent md:inline-flex"
      >
        Find a Pro
      </button>
      <button
        type="button"
        id="mobile-menu-toggle"
        class="header-menu-btn inline-flex items-center justify-center rounded-lg p-2 transition hover:opacity-90 md:hidden"
        aria-expanded="false"
        aria-controls="mobile-menu"
        aria-label="Open menu"
      >
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="header-mobile-menu hidden border-t border-white/10 bg-slate-900/98 backdrop-blur md:hidden" aria-hidden="true">
    <div class="flex flex-col items-center gap-1 px-4 py-4">
      {navLinks.map(({ href, label }) => (
        <a href={href} class="w-full rounded-lg px-3 py-2.5 text-sm font-bold text-center text-white hover:bg-white/10">
          {label}
        </a>
      ))}
      <a href={phone} class="w-full rounded-lg px-3 py-2.5 text-sm font-bold text-center text-white hover:bg-white/10">
        (818) 584-7389
      </a>
      <button type="button" data-open-booking="true" class="mt-2 w-full rounded-lg bg-[#f97415] px-3 py-2.5 text-center text-sm font-semibold text-white hover:bg-[#ea580c]">
        Find a Pro
      </button>
    </div>
  </div>
</header>

<style is:global>
  /* Transparent at top: use both class and data attr so we always win over base/utility styles */
  #site-header[data-transparent-header="true"]:not(.site-header-scrolled),
  #site-header.header-transparent:not(.site-header-scrolled) {
    background: transparent !important;
    background-color: transparent !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  #site-header[data-transparent-header="true"]:not(.site-header-scrolled) .header-nav-link,
  #site-header.header-transparent:not(.site-header-scrolled) .header-nav-link { color: rgba(255, 255, 255, 0.95); }
  #site-header[data-transparent-header="true"]:not(.site-header-scrolled) .header-nav-link:hover,
  #site-header.header-transparent:not(.site-header-scrolled) .header-nav-link:hover,
  #site-header[data-transparent-header="true"]:not(.site-header-scrolled) .header-nav-link--active,
  #site-header.header-transparent:not(.site-header-scrolled) .header-nav-link--active { color: #0073e6; }
  #site-header[data-transparent-header="true"]:not(.site-header-scrolled) .header-phone-text,
  #site-header.header-transparent:not(.site-header-scrolled) .header-phone-text { color: rgba(255, 255, 255, 0.95); }
  #site-header[data-transparent-header="true"]:not(.site-header-scrolled) .header-phone-icon,
  #site-header.header-transparent:not(.site-header-scrolled) .header-phone-icon { color: #fff; }
  #site-header[data-transparent-header="true"]:not(.site-header-scrolled) .header-cta,
  #site-header.header-transparent:not(.site-header-scrolled) .header-cta { background-color: #0073e6; }
  #site-header[data-transparent-header="true"]:not(.site-header-scrolled) .header-cta:hover,
  #site-header.header-transparent:not(.site-header-scrolled) .header-cta:hover { background-color: #0062cc; }
  #site-header[data-transparent-header="true"]:not(.site-header-scrolled) .header-menu-btn,
  #site-header.header-transparent:not(.site-header-scrolled) .header-menu-btn { color: rgba(255, 255, 255, 0.9); }
  #site-header .header-logo-wrap,
  #site-header .header-logo { background: none !important; background-color: transparent !important; }
  #site-header[data-transparent-header="true"]:not(.site-header-scrolled) .header-logo-wrap,
  #site-header.header-transparent:not(.site-header-scrolled) .header-logo-wrap { background: transparent !important; }
  #site-header[data-transparent-header="true"]:not(.site-header-scrolled) .header-logo--light,
  #site-header.header-transparent:not(.site-header-scrolled) .header-logo--light { display: block !important; visibility: visible !important; opacity: 1 !important; }
  #site-header[data-transparent-header="true"]:not(.site-header-scrolled) .header-logo--dark,
  #site-header.header-transparent:not(.site-header-scrolled) .header-logo--dark { display: none !important; visibility: hidden !important; opacity: 0 !important; }

  /* Scrolled: only then show white header – never applied at top */
  #site-header.site-header-scrolled {
    background: rgba(255, 255, 255, 0.98) !important;
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  }
  #site-header.site-header-scrolled .header-nav-link { color: #1d2530; }
  #site-header.site-header-scrolled .header-nav-link:hover,
  #site-header.site-header-scrolled .header-nav-link--active { color: #0073e6; }
  #site-header.site-header-scrolled .header-phone-text { color: #334155; }
  #site-header.site-header-scrolled .header-phone-icon { color: #334155; }
  #site-header.site-header-scrolled .header-cta { background-color: #004080; color: #fff; }
  #site-header.site-header-scrolled .header-cta:hover { background-color: #003366; }
  #site-header.site-header-scrolled .header-menu-btn { color: #475569; }
  #site-header.site-header-scrolled .header-logo-wrap { background: transparent !important; }
  #site-header.site-header-scrolled .header-logo--light { display: none !important; visibility: hidden !important; opacity: 0 !important; }
  #site-header.site-header-scrolled .header-logo--dark {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
  }

  /* Scrolled mobile menu: light panel with dark text */
  #site-header.site-header-scrolled #mobile-menu {
    background: rgba(255, 255, 255, 0.96) !important;
    border-top-color: rgba(148, 163, 184, 0.4);
  }
  #site-header.site-header-scrolled #mobile-menu a {
    color: #1d2530 !important;
  }
  #site-header.site-header-scrolled #mobile-menu a:hover {
    background-color: #e5e7eb !important;
  }
</style>

<script>
  (function () {
    const header = document.getElementById('site-header');
    const toggle = document.getElementById('mobile-menu-toggle');
    const menu = document.getElementById('mobile-menu');
    const scrollThreshold = 100;

    function updateHeader() {
      if (!header) return;
      if (header.getAttribute('data-transparent-header') !== 'true') return;
      if (window.scrollY >= scrollThreshold) {
        header.classList.add('site-header-scrolled');
        header.style.setProperty('background', 'rgba(255,255,255,0.98)', 'important');
        header.style.setProperty('background-color', 'rgba(255,255,255,0.98)', 'important');
      } else {
        header.classList.remove('site-header-scrolled');
        header.style.setProperty('background', 'transparent', 'important');
        header.style.setProperty('background-color', 'transparent', 'important');
      }
    }

    window.addEventListener('scroll', updateHeader, { passive: true });
    updateHeader();
    document.addEventListener('DOMContentLoaded', updateHeader);
    window.addEventListener('load', updateHeader);

    if (toggle && menu) {
      toggle.addEventListener('click', function () {
        const open = menu.classList.toggle('hidden');
        toggle.setAttribute('aria-expanded', String(!open));
        toggle.setAttribute('aria-label', open ? 'Open menu' : 'Close menu');
      });
    }
  })();
</script>
