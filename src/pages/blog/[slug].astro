---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const { title, description, pubDate, author, readingTime } = entry.data;

const canonical = `https://www.dealsofquality.com/blog/${entry.slug}/`;
const formatDate = (d: Date) => d.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
---

<BaseLayout
  title={`${title} | Deals Of Quality`}
  description={description}
  canonical={canonical}
>
  <main class="flex-1">
    <article class="min-h-screen bg-background">
      <!-- Article Header -->
      <div class="bg-secondary/30 relative overflow-hidden pt-24 pb-12 md:pt-32 md:pb-16">
        <div class="absolute top-0 right-0 w-[400px] h-[400px] bg-accent/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2" aria-hidden="true"></div>
        <div class="container-max px-4 md:px-8 lg:px-16 relative z-10">
          <div class="max-w-4xl mx-auto">
            <a
              href="/articles/"
              class="inline-flex items-center gap-2 text-muted-foreground hover:text-accent transition-colors mb-6"
            >
              <svg class="w-4 h-4 rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
              Back to Articles
            </a>
            <div class="flex items-center gap-4 text-sm text-muted-foreground mb-6">
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span>{formatDate(pubDate)}</span>
              </div>
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>{readingTime ?? 5} min read</span>
              </div>
            </div>
            <h1 class="font-display text-4xl md:text-5xl lg:text-6xl font-bold text-foreground mb-6 leading-tight">
              {title}
            </h1>
            <p class="text-xl text-muted-foreground leading-relaxed">
              {description}
            </p>
          </div>
        </div>
      </div>

      <!-- Article Content -->
      <div class="section-padding">
        <div class="container-max px-4 md:px-8 lg:px-16">
          <div class="max-w-4xl mx-auto prose prose-lg prose-slate dark:prose-invert prose-headings:font-display prose-headings:font-bold prose-a:text-[#0073e6] prose-a:no-underline hover:prose-a:underline">
            <Content />
          </div>
        </div>
      </div>

      <!-- CTA Section -->
      <div class="bg-primary text-primary-foreground py-16">
        <div class="container-max px-4 md:px-8 lg:px-16">
          <div class="max-w-4xl mx-auto text-center">
            <h2 class="font-display text-3xl md:text-4xl font-bold mb-4">
              Ready to Get Started?
            </h2>
            <p class="text-xl opacity-90 mb-8">
              Get a free quote or book a vetted pro for your next project.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
              <a
                href="/#get-quote"
                class="inline-flex items-center justify-center rounded-lg bg-primary-foreground text-primary font-semibold px-6 py-3 hover:opacity-90 transition"
              >
                Get a Free Quote
              </a>
              <a
                href="/services/"
                class="inline-flex items-center justify-center rounded-lg border-2 border-primary-foreground text-primary-foreground font-semibold px-6 py-3 hover:bg-primary-foreground hover:text-primary transition"
              >
                Browse Services
              </a>
            </div>
          </div>
        </div>
      </div>
    </article>
  </main>
</BaseLayout>
